# Migration `20200711041320`

This migration has been generated by Yuri Yakovlev at 7/11/2020, 4:13:20 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "UserRole" AS ENUM ('USER', 'ADMIN');

CREATE TYPE "Side" AS ENUM ('SIDE_A', 'SIDE_B');

CREATE TABLE "public"."Battle" (
"description" text  NOT NULL ,
"id" text  NOT NULL ,
"sideA" text  NOT NULL ,
"sideB" text  NOT NULL ,
"userId" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."User" (
"email" text  NOT NULL ,
"fullName" text  NOT NULL ,
"id" text  NOT NULL ,
"password" text  NOT NULL ,
"role" "UserRole" NOT NULL DEFAULT E'USER',
"userName" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Argument" (
"battleId" text  NOT NULL ,
"id" text  NOT NULL ,
"side" "Side" NOT NULL ,
"text" text  NOT NULL ,
"userId" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE TABLE "public"."Comment" (
"argumentId" text   ,
"id" text  NOT NULL ,
"text" text  NOT NULL ,
"userId" text  NOT NULL ,
    PRIMARY KEY ("id"))

CREATE UNIQUE INDEX "User.userName" ON "public"."User"("userName")

CREATE UNIQUE INDEX "User.email" ON "public"."User"("email")

ALTER TABLE "public"."Battle" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Argument" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Argument" ADD FOREIGN KEY ("battleId")REFERENCES "public"."Battle"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Comment" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Comment" ADD FOREIGN KEY ("argumentId")REFERENCES "public"."Argument"("id") ON DELETE SET NULL  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200711041320
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,64 @@
+generator prisma_client {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+model Battle {
+  id          String     @id @default(cuid())
+  description String
+  sideA       String
+  sideB       String
+  arguments   Argument[]
+
+  User   User   @relation(fields: [userId], references: [id])
+  userId String
+}
+
+model User {
+  id        String     @id @default(cuid())
+  userName  String     @unique
+  email     String     @unique
+  password  String
+  fullName  String
+  battles   Battle[]
+  arguments Argument[]
+  comments  Comment[]
+
+  role UserRole @default(USER)
+}
+
+model Argument {
+  id       String    @id @default(uuid())
+  text     String
+  side     Side
+  comments Comment[]
+
+  User     User   @relation(fields: [userId], references: [id])
+  userId   String
+  Battle   Battle @relation(fields: [battleId], references: [id])
+  battleId String
+}
+
+model Comment {
+  id   String @id @default(uuid())
+  text String
+
+  User       User      @relation(fields: [userId], references: [id])
+  userId     String
+  Argument   Argument? @relation(fields: [argumentId], references: [id])
+  argumentId String?
+}
+
+enum UserRole {
+  USER
+  ADMIN
+}
+
+enum Side {
+  SIDE_A
+  SIDE_B
+}
```


