# Migration `20200705033736`

This migration has been generated by Yuri Yakovlev at 7/5/2020, 3:37:36 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "Side" AS ENUM ('sideA', 'sideB');

CREATE TABLE "public"."Argument" (
"battleId" text  NOT NULL ,"id" text  NOT NULL ,"side" "Side" NOT NULL ,"text" text  NOT NULL ,"userId" text  NOT NULL ,
    PRIMARY KEY ("id"))

ALTER TABLE "public"."Battle" ADD COLUMN "sideA" text  NOT NULL ,
ADD COLUMN "sideB" text  NOT NULL ;

ALTER TABLE "public"."Comment" DROP CONSTRAINT IF EXiSTS "Comment_battleId_fkey",
DROP COLUMN "battleId",
ADD COLUMN "argumentId" text   ;

ALTER TABLE "public"."Argument" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Argument" ADD FOREIGN KEY ("battleId")REFERENCES "public"."Battle"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Comment" ADD FOREIGN KEY ("argumentId")REFERENCES "public"."Argument"("id") ON DELETE SET NULL  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200705030612..20200705033736
--- datamodel.dml
+++ datamodel.dml
@@ -3,41 +3,61 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model Battle {
-  id          String    @id @default(cuid())
+  id          String     @id @default(cuid())
   description String
-  comments    Comment[]
+  sideA       String
+  sideB       String
+  arguments   Argument[]
   User   User   @relation(fields: [userId], references: [id])
   userId String
 }
 model User {
-  id       String    @id @default(cuid())
-  userName String    @unique
-  email    String    @unique
+  id       String     @id @default(cuid())
+  userName String     @unique
+  email    String     @unique
   password String
   fullName String
   battles  Battle[]
   comments Comment[]
-  role     UserRole  @default(USER)
+  role     UserRole   @default(USER)
+  Argument Argument[]
 }
-model Comment {
-  id   String @id @default(uuid())
-  text String
+model Argument {
+  id       String    @id @default(uuid())
+  text     String
+  side     Side
+  comments Comment[]
   User     User   @relation(fields: [userId], references: [id])
   userId   String
   Battle   Battle @relation(fields: [battleId], references: [id])
   battleId String
 }
+model Comment {
+  id   String @id @default(uuid())
+  text String
+
+  User       User      @relation(fields: [userId], references: [id])
+  userId     String
+  Argument   Argument? @relation(fields: [argumentId], references: [id])
+  argumentId String?
+}
+
 enum UserRole {
   USER
   ADMIN
 }
+
+enum Side {
+  SIDE_A  @map("sideA")
+  SIDE_B  @map("sideB")
+}
```


